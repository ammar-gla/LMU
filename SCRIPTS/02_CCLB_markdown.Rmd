---
title:  "<br> Claimant Count data for London Boroughs"
date: "`r format(Sys.Date(),'%B %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    css:  !expr "here::here('FORMATTING','GLAstyle.css')"
    includes:
      in_header: !expr "here::here('FORMATTING','favicon.html')"
      before_body: !expr "here::here('FORMATTING','header.html')"
      after_body: !expr "here::here('FORMATTING','footer.html')"
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_file = paste0("CCLB ",format(Sys.Date(),'%B %Y')),
      envir = globalenv()
    )
  })
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE,scipen=999)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

```

<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>
Contact: [Ammar Ljubijankić Kutasi](mailto:ammar.ljubijankic@london.gov.uk)
<br/>


```{r cc figures, echo=FALSE}

cc_newdate <- lon_cc_data  %>% filter(date_day==max(date_day)) %>% filter(row_number()==1) %>% pull(date_day)

cc_newdate_form <- format(cc_newdate,"%B %Y")

cc_newdate_form_abr <- format(cc_newdate,"%b %y")

cc_prev_month <- (cc_newdate)-months(1) #Used to save previous month's count

cc_prev_month_abr <- format(cc_prev_month,"%b %y")

cc_lastyear <- cc_newdate-years(1)

cc_lastyear_form <- format(cc_lastyear,"%B %Y")

cc_mar20_abr <- format(as.Date("2020-03-01"),"%b %y")

```

## Notes on the Claimant Count

<br/>

The ONS has published its latest figures for `r cc_newdate_form` for the number of people claiming unemployment related benefits - [the ONS Claimant Count](https://www.ons.gov.uk/employmentandlabourmarket/peoplenotinwork/unemployment/datasets/claimantcountandvacanciesdataset). This briefing presents the latest statistics for local authorities in London.

The claimant count is the number of people claiming Jobseeker’s Allowance plus people claiming Universal Credit who are required to seek work. It is a timely source of data for tracking changes in the labour market at a local level, although many new claimants will not be wholly unemployed, partly due to changes in Universal Credit eligibility*. Some claimants will be unemployed and seeking work, others may be temporarily inactive or away from work, or employed but with low earnings. For more information see [here](https://researchbriefings.files.parliament.uk/documents/CBP-8748/CBP-8748.pdf). 

Only non-seasonally adjusted data is available at the local level. We therefore use non seasonally adjusted data throughout this briefing for consistency.


<a href="#top">Back to top</a>

<foot>*Under Universal Credit, a broader span of claimants are also required to look for work than under Jobseeker’s
Allowance. The [DWP Alternative Claimant Count](https://www.gov.uk/government/collections/alternative-claimant-count-statistics) series adjusts for this over time. However, that series is less timely than the ONS Claimant Count and the differences between the two are modest for recent periods.<foot>

```{r lon_cc figures, echo=FALSE}

cc_lon_level <- value_form(lon_cc_data %>% filter( date_day == max(date_day) & measure_name=="claimant_count") %>% select(measure_value),s=signif_thous, d=digits_mil)

cc_lon_level_mar20 <- value_form(lon_cc_data %>% filter( date_day == as.Date("2020-03-01") & measure_name=="claimant_count") %>% select(measure_value),s=signif_thous, d=digits_mil)

cc_lon_p_mar20 <- perc_form(lon_cc_data %>% filter( date_day == max(date_day) & measure_name=="claimant_count") %>% select(p_change_since_mar20),d=0)

cc_lon_level_max <- value_form(lon_cc_data %>% filter( measure_name=="claimant_count") %>% filter( measure_value == max(measure_value))%>% select(measure_value),s=signif_thous, d=digits_mil)

cc_lon_level_max_date <- as.character(lon_cc_data %>% filter( measure_name=="claimant_count") %>% filter( measure_value == max(measure_value))%>% select(date_name))

cc_lon_d_max <- value_form(
  (lon_cc_data %>% filter(date_day == max(date_day) & measure_name=="claimant_count") %>% select(measure_value))-
  (lon_cc_data %>% filter(measure_name=="claimant_count") %>% filter( measure_value == max(measure_value))%>% select(measure_value))
  ,s=signif_thous, d=digits_mil)

cc_lon_p_max <- perc_form(
  (100*((lon_cc_data %>% filter(date_day == max(date_day) & measure_name=="claimant_count") %>% select(measure_value))-
     (lon_cc_data %>% filter(measure_name=="claimant_count") %>% filter(measure_value == max(measure_value))%>% select(measure_value)))/
    (lon_cc_data %>% filter(measure_name=="claimant_count") %>% filter(measure_value == max(measure_value))%>% select(measure_value)))
  , d=0)

cc_lon_d_mom <- value_form(lon_cc_data %>% filter( date_day == max(date_day) & measure_name=="claimant_count") %>% select(mom_d_change),s=signif_thous, d=digits_mil)

cc_lon_p_mom <- perc_form(lon_cc_data %>% filter( date_day == max(date_day) & measure_name=="claimant_count") %>% select(mom_p_change), d=digits_perc)

```


<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>

## London claimant count

<br/>

Changes in the claimant count in London since March 2020 help to illustrate the impact of the COVID-19 pandemic on the labour market.

- From March 2020 to `r cc_newdate_form`, the non-seasonally adjusted claimant count `r condi_text(cc_lon_p_mar20,"rise")` from `r cc_lon_level_mar20` to `r cc_lon_level` (`r abs2(cc_lon_p_mar20)`%).
- The claimant count peaked at approximately `r cc_lon_level_max` in `r cc_lon_level_max_date`. Since then, the non-seasonally adjusted claimant count `r condi_text(cc_lon_d_max,"rise")` by around `r abs2(cc_lon_d_max)` (`r abs2(cc_lon_p_max)`%).
- Focusing on the last month, in the period up to `r cc_newdate_form`, the non-seasonally adjusted claimant count `r condi_text(cc_lon_d_mom,"rise")`  by `r abs2(cc_lon_d_mom)` (`r abs2(cc_lon_p_mom)`%). 

The following sections present a breakdown of the latest data for people living in local authorities in London.

<a href="#top">Back to top</a>

```{r Lon CC chart, echo=FALSE,fig.cap = lon_cc_cap, out.width='100%' }

pal <- gla_pal(gla_theme = "default", palette_type = "highlight", n = c(1, 1))
theme_set(theme_gla(gla_theme = "default"))

lon_cc_timechart <- lon_cc_data  %>%
  filter(date_day >= "2019-01-01" & measure_name == "claimant_count") %>%
  select(date_day,measure_value,geography_name) %>% 
  ggplot(mapping = aes(x = date_day, y = measure_value,
                       colour = geography_name, group = geography_name,
                       text = paste0(
                         format(date_day,'%B %Y'), "\n",
                         "Claimant count: ", value_form(measure_value), "\n"))) +
  ggla_line(aes(size= geography_name)) +
  geom_vline(aes(xintercept = as.numeric(ymd("2020-03-01"))),
             linetype = "dotted",
             size = 1 * mm_to_pt,
             colour = rgb(166,166,166,maxColorValue = 255)) + # mark lockdowns start
  scale_size_manual(values = c(2 * mm_to_pt)) +
  scale_colour_manual(values = pal) +
  coord_cartesian(clip = 'off') +
  geom_hline(aes(yintercept=0), colour="gray45") +
  scale_y_continuous(expand = c(0, 0), labels = dollar_format(prefix = "",
                                                              suffix = "",
                                                              largest_with_cents = 1),
                     limits = c(0,550000)) +
  scale_x_date( date_breaks = "4 months",
                date_labels = "%b'%y",
                expand = expansion( mult = c(0.02,0.02))) +
  theme(plot.margin = unit(c(1,1,1,1), "cm"))+
  labs(title =  "ONS Claimant Count in London",
       subtitle = paste0("January 2020 to ", lon_cc_data$date_name[lon_cc_data$date_day == max(lon_cc_data$date_day)]," (not seasonally adjusted)"),
       caption = "\nSource: Claimant count by sex and age (Nomis) – data is not seasonally adjusted (NSA).\n\nNote: March 2020 indicated by dotted line.")+
  theme(plot.caption = element_text(color = rgb(166,166,166,maxColorValue = 255)))

ggsave( paste0(IMAGES,Sys.Date(),"_","lon_cc",".svg"), device = "svg", width = 8, height = 8, units = "in")
ggsave( paste0(IMAGES,Sys.Date(),"_","lon_cc",".png"), device = "png", width = 8, height = 8, units = "in")


ggplotly(lon_cc_timechart,tooltip = "text") %>% 
  ggla_plotly_settings()    %>% 
  layout(title = list(text = paste0("<b>","ONS Claimant Count in London","</b>",
                                    "<br>",
                                    "<sup>",
                                    paste0("January 2020 to ", lon_cc_data$date_name[lon_cc_data$date_day == max(lon_cc_data$date_day)]," (not seasonally adjusted)"),
                                    "</sup>",
                                    "<br>"),
         font = list(size = 22),
         y = .95, xref = "plot"),
         xaxis = list(tickfont = list(size = 15)),
         yaxis = list(tickfont = list(size = 15)),
         legend = list(font = list(size = 15),title=list(text="")),
         hovermode = "x") %>% 
  plotly_modebar

lon_cc_cap <- paste0("Source: Claimant count by sex and age (Nomis) – data is not seasonally adjusted (NSA).","<br>","<br>", "Note: March 2020 indicated by dotted line.")

```
<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>


## Regional comparison

``` {r cc region stats, echo=FALSE}

cc_regions_comp_data <- cc_changes_stats %>% 
  filter(dataset_name=="region" & date_day %in% c(cc_newdate,cc_lastyear) & measure_name=="claimants_as_a_proportion_of_residents_aged_16_64") %>% 
  mutate(date_comp = case_when(date_day==cc_newdate ~ "2. new",
                               date_day==cc_lastyear ~ "1. old"))

# Find min and max regions
cc_region_rate_max <- cc_regions_comp_data %>% 
  filter(date_day==cc_newdate) %>% 
  filter(measure_value==max(measure_value)) %>% 
  pull(measure_value)

cc_region_rate_max_name <- cc_regions_comp_data %>% 
  filter(date_day==cc_newdate) %>% 
  filter(measure_value==max(measure_value)) %>% 
  pull(geography_name)

cc_region_rate_max_y <- cc_regions_comp_data %>% 
  filter(date_day==cc_lastyear ) %>% 
  filter(measure_value==max(measure_value)) %>% 
  pull(measure_value)

cc_region_rate_max_y_name <- cc_regions_comp_data %>% 
  filter(date_day==cc_lastyear ) %>% 
  filter(measure_value==max(measure_value)) %>% 
  pull(geography_name)

cc_region_rate_min <- cc_regions_comp_data %>% 
  filter(date_day==cc_newdate) %>% 
  filter(measure_value==min(measure_value)) %>% 
  pull(measure_value)

cc_region_rate_min_name <- cc_regions_comp_data %>% 
  filter(date_day==cc_newdate) %>% 
  filter(measure_value==min(measure_value)) %>% 
  pull(geography_name)

cc_region_rate_min_y <- cc_regions_comp_data %>% 
  filter(date_day==cc_lastyear ) %>% 
  filter(measure_value==min(measure_value)) %>% 
  pull(measure_value)

cc_region_rate_min_y_name <- cc_regions_comp_data %>% 
  filter(date_day==cc_lastyear ) %>% 
  filter(measure_value==min(measure_value)) %>% 
  pull(geography_name)

```

<br/>

The claimant count rate varies between the regions and countries of the UK.

*  The region/country with the highest claimant count rate in `r cc_newdate_form` was `r cc_region_rate_max_name` (`r perc_form(cc_region_rate_max)`%), while the lowest rate was in `r cc_region_rate_min_name` (`r perc_form(cc_region_rate_min)`%).

*  A year earlier in `r cc_lastyear_form`, the region/country with the highest rate was `r cc_region_rate_max_y_name` (`r perc_form(cc_region_rate_max_y)`%), while the lowest rate was in `r cc_region_rate_min_y_name` (`r perc_form(cc_region_rate_min_y)`%).

<a href="#top">Back to top</a>

```{r region CC chart, echo=FALSE,fig.cap = lon_cc_cap, out.width='100%' }



# Rank by largest rates in latest data
cc_regions_rank <- cc_regions_comp_data %>% 
  filter(date_day==cc_newdate) %>% 
  arrange(measure_value) %>% 
  pull(geography_name)

regions_nm <- c("London",setdiff(sort(unique(cc_regions_comp_data$geography_name)),"London"))
regions_n <- length(regions_nm)
pal <- setNames(gla_pal(palette_type = "highlight",n=c(1,regions_n-1)),regions_nm)
alpha_nm <- setNames(c(0.7,1),nm=c("1. old","2. new"))

# CHart
cc_region_comp_chart <- cc_regions_comp_data %>% 
  group_by(geography_name) %>% 
  ggplot(mapping = aes(x = factor(geography_name,levels=cc_regions_rank), 
                       y = measure_value/100, # Divide to fit into percentage axis
                       fill=geography_name,
                       alpha=date_comp,
                       text = paste0("Date: ",format(date_day,"%b %Y"),"\n",
                                     geography_name, "\n",
                                     "Rate: ", perc_form(measure_value),"%", "\n"))) +
  geom_bar(stat = "identity", position = position_dodge(), width = 0.4)+
  geom_hline(aes(yintercept=0), colour="gray45") +
  scale_fill_manual(values = pal) +
  scale_alpha_manual(values=alpha_nm)+
  theme_set(theme_gla(gla_theme = "default")) +
  scale_y_continuous(labels = percent_format(accuracy=1),
                     limits=c(0,0.08)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 8))+
  theme(axis.text.x = element_text( hjust=1, vjust=0.5)) +
  theme(plot.margin = unit(c(1,1,1,1), "cm"))+
  labs(title = "Claimant count rate by region",
       subtitle = paste0("Latest data for ", cc_newdate_form),
       caption = "\nSource:  Claimant count by sex and age (Nomis) – data is not seasonally adjusted (NSA).") +
  theme(plot.caption = element_text(color = rgb(166,166,166,maxColorValue = 255)),
        legend.position = "none")

LMU_plotly_settings(ch_name = cc_region_comp_chart,
                    title_text = 'paste0("Claimant count rate by region")',
                    subtitle_text = 'paste0("Rates for latest data, ", cc_newdate_form, ", and in previous year")',
                    hover_mode = "closest") %>% 
  hide_legend()


lon_cc_cap <- paste0("Source: Claimant count by sex and age (Nomis) – data is not seasonally adjusted (NSA).")

```
<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>

```{r cc_la stats 1, echo=FALSE}

highest_cc_rate <- cc_changes_stats %>% filter(is_la==1 & date_day==max(date_day) & sex_name=="Total" & age_name=="All categories: Age 16+" & measure_name=="claimants_as_a_proportion_of_residents_aged_16_64") %>% slice_max(measure_value,n=3) 

highest_cc_level <- cc_changes_stats %>% filter(is_la==1 & date_day==max(date_day) & sex_name=="Total" & age_name=="All categories: Age 16+" & measure_name=="claimant_count") %>% slice_max(measure_value,n=3) 

```



## Claimant count by London local authority {.tabset}

<br/>

Across London local authorities in `r cc_newdate_form`:

- `r as.character(highest_cc_rate[1,"geography_name"])` had the highest claimant rate at `r perc_form(highest_cc_rate[1,"measure_value"])`%, followed by `r as.character(highest_cc_rate[2,"geography_name"])` (`r perc_form(highest_cc_rate[2,"measure_value"])`%) and `r as.character(highest_cc_rate[3,"geography_name"])` (`r perc_form(highest_cc_rate[3,"measure_value"])`%).

- `r as.character(highest_cc_level[1,"geography_name"])` had the highest claimant count level at `r value_form(highest_cc_level[1,"measure_value"],s=signif_thous)`, followed by `r as.character(highest_cc_level[2,"geography_name"])` (`r value_form(highest_cc_level[2,"measure_value"],s=signif_thous)`) and `r as.character(highest_cc_level[3,"geography_name"])` (`r value_form(highest_cc_level[3,"measure_value"],s=signif_thous)`).

<a href="#top">Back to top</a>


```{r cc borough map, echo=FALSE}
  
  # Produces two interactive maps, one with count and one with rate

# Read in data and transform to long-lat format geometry
la_cc_map_data_geo <- read_sf(here("INPUT","statistical-gis-boundaries-london","ESRI","London_Borough_Excluding_MHW.shp")) %>% 
  clean_names() %>% 
  select(name,geometry) %>% 
  rename(geography_name=name) %>%  
  left_join(la_cc_map_data,by="geography_name") %>% 
  mutate(tooltip=case_when(measure_name=="claimant_count" ~  
                             paste0("Claimant count: ",value_form(measure_value,s=signif_thous), "\n"),
                           measure_name=="claimants_as_a_proportion_of_residents_aged_16_64" ~ 
                             paste0("Claimant rate: ",perc_form(measure_value),"%", "\n"))) %>% 
  st_transform(4326) %>% 
  select(measure_value,measure_name,geometry,tooltip,geography_name)

# Filtered datasets
la_cc_map_data_geo_rate <- la_cc_map_data_geo %>% 
  filter(measure_name=="claimants_as_a_proportion_of_residents_aged_16_64")

la_cc_map_data_geo_claimant <- la_cc_map_data_geo %>% 
  filter(measure_name=="claimant_count")

  # Title and captions
  map_title_rate <- paste0("Claimants as a proportion","<br>" ,"of residents aged 16-64")
  map_title_count <- paste0("Number of claimants","<br>" ,"aged 16+")
  
  map_cap <- paste0("Source: Claimant count by sex and age (Nomis) – data is not seasonally adjusted. Contains Ordnance Survey data Crown copyright and database rights [2015].")
  
  # Maps for rates
  cc_leaflet_rate <- leaflet_map_output(dataset=la_cc_map_data_geo_rate,
                     dt_var="measure_value",
                     bin_rounding = 1,
                     pal_colour = "red",
                     title=map_title_rate,
                     perc_bin = TRUE)
  
  cc_ggplot_rate <- ggplot_map_output(dataset=la_cc_map_data_geo_rate,
                                      dt_var="measure_value",
                                      pal_colour="red",
                                      perc_bin=TRUE,
                                      title=map_title_rate,
                                      bin_rounding=1,
                                      chart_name="cc_rate_la_map",
                                      caption_txt=map_cap)
  
  # Maps for counts
  cc_leaflet_count <- leaflet_map_output(dataset=la_cc_map_data_geo_claimant,
                     dt_var="measure_value",
                     bin_rounding = 3000,
                     pal_colour = "red",
                     title=map_title_count,
                     perc_bin = FALSE)
  
  
  cc_ggplot_count <- ggplot_map_output(dataset=la_cc_map_data_geo_claimant,
                                      dt_var="measure_value",
                                      pal_colour="red",
                                      perc_bin=FALSE,
                                      title=map_title_count,
                                      bin_rounding=3000,
                                      chart_name="cc_count_la_map",
                                      caption_txt=map_cap)

  

```


### Claimant rate
``` {r map rate, echo=FALSE,fig.cap = map_cap,out.width='100%'}

  cc_leaflet_rate

```

<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>

### Number of claimants

``` {r map count, echo=FALSE,fig.cap = map_cap,out.width='100%'}

cc_leaflet_count

```

<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>

```{r cc_la stats 2, echo=FALSE}
  
  highest_cc_count_growth <- cc_changes_stats %>% filter(is_la==1 & date_day==max(date_day) & sex_name=="Total" & age_name=="All categories: Age 16+" & measure_name=="claimant_count") %>% slice_max(d_change_since_mar20,n=3) 
  
  highest_cc_rate_growth <- cc_changes_stats %>% filter(is_la==1 & date_day==max(date_day) & sex_name=="Total" & age_name=="All categories: Age 16+" & measure_name=="claimants_as_a_proportion_of_residents_aged_16_64") %>% slice_max(d_change_since_mar20,n=3) 

  # Loop through the count and rate highest growers 
  
  for (measure in c("count","rate")) {
    
    dat_temp <- eval(as.name(paste0("highest_cc_",measure,"_growth")))
    
    for (num_la in 1:3) {
      
      growth_high_x_name <- dat_temp %>% filter(row_number()==num_la) %>% pull(geography_name)
      
      growth_high_x_d <- dat_temp %>% filter(row_number()==num_la) %>% select(d_change_since_mar20)
      
      growth_high_x_p <- perc_form(dat_temp %>% filter(row_number()==num_la) %>% select(p_change_since_mar20),d = 0)
      
      assign(paste0("la_growth_high_",measure,"_",num_la,"_name"),growth_high_x_name)
      assign(paste0("la_growth_high_",measure,"_",num_la,"_d"),growth_high_x_d)
      assign(paste0("la_growth_high_",measure,"_",num_la,"_p"),growth_high_x_p)
      remove(growth_high_x_name)
      remove(growth_high_x_d)
      remove(growth_high_x_p)
    }
  }
  
  remove(measure)
  remove(num_la)
  
  gender_cc_growth <- cc_changes_stats %>%
    filter(is_la==1 & date_day==max(date_day) & age_name=="All categories: Age 16+" & measure_name=="claimant_count") %>% 
    select(geography_name,sex_name,d_change_since_mar20) %>%
    pivot_wider(id_cols = geography_name,names_from = sex_name,values_from = d_change_since_mar20) %>% 
    clean_names() %>% 
    mutate(male_share=male/total*100, female_share=female/total*100)
  
  min_male_share <- min(gender_cc_growth$male_share)
  max_male_share <- max(gender_cc_growth$male_share)

```


## Changes by local authority {.tabset}

<br/>

Between March 2020 and `r cc_newdate_form`:

 - The boroughs of `r la_growth_high_count_1_name`, `r la_growth_high_count_2_name` and `r la_growth_high_count_3_name` saw the largest absolute increases in the claimant count. They saw increases of `r value_form(la_growth_high_count_1_d, s = signif_thous)` (`r la_growth_high_count_1_p`%), `r value_form(la_growth_high_count_2_d, s = signif_thous)` (`r la_growth_high_count_2_p`%), and `r value_form(la_growth_high_count_3_d, s = signif_thous)` (`r la_growth_high_count_3_p`%), respectively.
 
 - The boroughs with the highest percentage point increases in the claimant rate were  `r la_growth_high_rate_1_name` (`r value_form(la_growth_high_rate_1_d, d=1)`pp), `r la_growth_high_rate_2_name` (`r value_form(la_growth_high_rate_2_d, d=1)`pp), and `r la_growth_high_rate_3_name` (`r value_form(la_growth_high_rate_3_d, d=1)`pp).
 
 - Men accounted for between `r perc_form(min_male_share,d=0)`% and `r perc_form(max_male_share,d=0)`% of the net increase in claimants recorded across local authorities.

<a href="#top">Back to top</a>

### Change in claimant count

```{r cc bar by LA, echo=FALSE,fig.cap = la_barcap, out.width='100%'}

pal <- gla_pal(gla_theme = "default", palette_type = "highlight", n = c(1, 1))
theme_set(theme_gla(gla_theme = "default"))


# Filter for LA and rank according to most total claimants
la_cc_ranking <- cc_changes_stats %>%  
  filter(is_la==1 & date_day==max(date_day) & age_name=="All categories: Age 16+" & sex_name=="Total" & measure_name=="claimant_count") %>% 
  mutate(chart_rank=dense_rank(desc(d_change_since_mar20))) %>% 
  select(geography_name,chart_rank)


la_cc_bar <- cc_changes_stats %>%  
  filter(is_la==1 & date_day==max(date_day) & age_name=="All categories: Age 16+" & sex_name!="Total" & measure_name=="claimant_count") %>% 
  merge(la_cc_ranking,by="geography_name") %>% 
  group_by(geography_name,sex_name)  %>%
  arrange(-chart_rank,sex_name) %>% 
  select(geography_name,chart_rank,d_change_since_mar20,sex_name) %>% 
  ggplot(mapping = aes(x =  factor(reorder(geography_name, -chart_rank)),
                       y = d_change_since_mar20, 
                       colour = sex_name , fill=sex_name, width = 0.5,
                       text = paste0(geography_name, "\n",
                                    sex_name,"\n",
                                    "Change: ", value_form(d_change_since_mar20), "\n"))) +
  geom_bar(stat = "identity", position = "stack") +
  geom_hline(aes(yintercept=0), colour="gray45") +
  scale_color_manual(values = c(pal[1],pal[1]), aesthetics = "colour")+
  scale_fill_manual(values = c("white",pal[1]), aesthetics = "fill")+
  theme_set(theme_gla(gla_theme = "default", y_label_length=100)) + #GLA theme and removes lines below y-axis labels
  scale_y_continuous(limits = c(0, 10000), labels = dollar_format(prefix = "", 
                                                                 suffix = "", 
                                                                 largest_with_cents = 1)) +
  theme(plot.margin = unit(c(1,1,1,1), "cm"))+
  scale_x_discrete(expand = c(0,0)) +
  theme(panel.grid.major.y = element_blank(), #removed y grid
        panel.grid.minor.y = element_blank(), # removes small y grid
        panel.grid.major.x = element_line( size=.5 ), # removes x grid
        axis.text.y = ggplot2::element_text( # ensures (now flipped) y axis labels stay outside chart
              hjust = 0, vjust = 0.5,
              margin = ggplot2::margin(t = 0, r = 0, b = 0, l = 0,
                                       unit = "pt")),
        axis.ticks.length.y = ggplot2::unit(x = 0, units = "pt")) + #removes ticks from (now flipped) y axis
  coord_flip()+
  labs(title = paste0("Change in claimant count by local authority and sex"),
       subtitle = paste0("Non-seasonally adjusted, between March 2020 and ", cc_newdate_form),
       caption = "\nSource:  Claimant count by sex and age (Nomis) – data is not seasonally adjusted.")+
  theme(plot.caption = element_text(color = rgb(166,166,166,maxColorValue = 255)))

ggsave(paste0(IMAGES,Sys.Date(),"_","la_bar_change",".svg"), device = "svg", width = 8, height = 8, units = "in")
ggsave(paste0(IMAGES,Sys.Date(),"_","la_bar_change",".png"), device = "png", width = 8, height = 8, units = "in")


#knitr::include_graphics(paste0(IMAGES,Sys.Date(),"_","wfj_industries",".svg"))

ggplotly(la_cc_bar,tooltip = "text") %>% 
  ggla_plotly_settings()    %>% 
  layout(title = list(text = paste0("<b>","Change in claimant count by local authority and sex","</b>",
                                    "<br>",
                                    "<sup>",
                                    paste0("Non-seasonally adjusted, between March 2020 and ", cc_newdate_form),
                                    "</sup>",
                                    "<br>"),
                      font = list(size = 22),
                      y = .95, xref = "plot"),
         xaxis = list(tickfont = list(size = 14), showgrid=TRUE),
         yaxis = list(tickfont = list(size = 12), showgrid=FALSE),
         legend = list(font = list(size = 14),title=list(text="")),
         margin = list(l = 160)) %>% 
  reverse_legend_labels() %>% 
  plotly_modebar


la_barcap <- paste0("Source: Claimant count by sex and age (Nomis) – data is not seasonally adjusted.")

```
<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>

### Change in claimant rate

```{r cc bar rate by LA, echo=FALSE,fig.cap = la_bar_ratecap, out.width='100%'}

pal <- gla_pal(gla_theme = "default", palette_type = "highlight", n = c(1, 1))
theme_set(theme_gla(gla_theme = "default"))


# Filter for LA and rank according to most total claimants
la_cc_ranking_rate <- cc_changes_stats %>%  
  filter(is_la==1 & date_day==max(date_day) & age_name=="All categories: Age 16+" & sex_name=="Total" & measure_name=="claimants_as_a_proportion_of_residents_aged_16_64") %>% 
  mutate(chart_rank=dense_rank(desc(d_change_since_mar20))) %>% 
  select(geography_name,chart_rank)


la_cc_rate_bar <- cc_changes_stats %>%  
  filter(is_la==1 & date_day==max(date_day) & age_name=="All categories: Age 16+" & sex_name=="Total" & measure_name=="claimants_as_a_proportion_of_residents_aged_16_64") %>% 
  merge(la_cc_ranking_rate,by="geography_name") %>% 
  group_by(geography_name)  %>%
  arrange(-chart_rank) %>% 
  select(geography_name,chart_rank,d_change_since_mar20) %>% 
  ggplot(mapping = aes(x =  factor(reorder(geography_name, -chart_rank)),
                       y = d_change_since_mar20, width = 0.5,
                       text = paste0(geography_name, "\n",
                                    "Change: ", value_form(d_change_since_mar20,d=1),"pp", "\n"))) +
  geom_bar(stat = "identity", position = "stack", fill=pal[1],colour=pal[1]) +
  geom_hline(aes(yintercept=0), colour="gray45") +
  theme_set(theme_gla(gla_theme = "default", y_label_length=100)) + #GLA theme and removes lines below y-axis labels
  scale_y_continuous(limits = c(0, 4.5), labels = dollar_format(prefix = "", 
                                                                 suffix = "pp", 
                                                                 largest_with_cents = 1)) +
  theme(plot.margin = unit(c(1,1,1,1), "cm"))+
  scale_x_discrete(expand = c(0,0)) +
  theme(panel.grid.major.y = element_blank(), #removed y grid
        panel.grid.minor.y = element_blank(), # removes small y grid
        panel.grid.major.x = element_line( size=.5 ), # removes x grid
        axis.text.y = ggplot2::element_text( # ensures (now flipped) y axis labels stay outside chart
              hjust = 0, vjust = 0.5,
              margin = ggplot2::margin(t = 0, r = 0, b = 0, l = 0,
                                       unit = "pt")),
        axis.ticks.length.y = ggplot2::unit(x = 0, units = "pt")) + #removes ticks from (now flipped) y axis
  coord_flip()+
  labs(title = paste0("Change in claimant rate (16-64) by local authority"),
       subtitle = paste0("Non-seasonally adjusted, percentage point change between March 2020 and ", cc_newdate_form),
       caption = "\nSource:  Claimant count by sex and age (Nomis) – data is not seasonally adjusted.")+
  theme(plot.caption = element_text(color = rgb(166,166,166,maxColorValue = 255)))

ggsave(paste0(IMAGES,Sys.Date(),"_","la_bar_change",".svg"), device = "svg", width = 8, height = 8, units = "in")
ggsave(paste0(IMAGES,Sys.Date(),"_","la_bar_change",".png"), device = "png", width = 8, height = 8, units = "in")

ggplotly(la_cc_rate_bar,tooltip = "text") %>% 
  ggla_plotly_settings()    %>% 
  layout(title = list(text = paste0("<b>","Change in claimant rate (16-64) by local authority","</b>",
                                    "<br>",
                                    "<sup>",
                                    paste0("Non-seasonally adjusted, percentage point change between March 2020 and ", cc_newdate_form),
                                    "</sup>",
                                    "<br>"),
                      font = list(size = 22),
                      y = .95, xref = "plot"),
         xaxis = list(tickfont = list(size = 14), showgrid=TRUE),
         yaxis = list(tickfont = list(size = 12), showgrid=FALSE),
         legend = list(font = list(size = 14),title=list(text="")),
         margin = list(l = 160)) %>% 
  reverse_legend_labels() %>% 
  plotly_modebar


la_bar_ratecap <- paste0("Source: Claimant count by sex and age (Nomis) – data is not seasonally adjusted.")

```


<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>

```{r cc_la_age stats 2, echo=FALSE}
# Produce stats on borough*age changes in claimant count

set.seed(1000) #for reproducibility of jitter function

la_age_cc_data <- cc_changes_stats %>% 
  filter(date_day==max(date_day) & measure_name=="claimant_count" & sex_name=="Total" & 
           (age_name %in% c("Aged 16-24","Aged 50+","Aged 25-49")) &
           ((is_la==1 & geography_name!="City of London") | geography_name %in% c("London","United Kingdom"))) %>% 
  select(c(date_day:p_change_since_mar20,is_la)) %>%  
  mutate(jit_age = jitter(as.numeric(factor(rev(age_name)))),# Jitter to scatter bubble slightly around category
         geo_cat = case_when(is_la==1 ~ "Boroughs",
                             geography_name=="London" ~"London",
                             geography_name=="United Kingdom" ~ "UK")) 

high_1624_la_name <- la_age_cc_data %>% filter(age_name=="Aged 16-24" & is_la==1) %>%
  filter(p_change_since_mar20==max(p_change_since_mar20)) %>% 
  pull(geography_name)

high_1624_la_p <- perc_form(la_age_cc_data %>% filter(age_name=="Aged 16-24" & is_la==1) %>%
  filter(p_change_since_mar20==max(p_change_since_mar20)) %>% 
  pull(p_change_since_mar20),d=0)

high_2549_la_name <- la_age_cc_data %>% filter(age_name=="Aged 25-49" & is_la==1) %>%
  filter(p_change_since_mar20==max(p_change_since_mar20)) %>% 
  pull(geography_name)

high_2549_la_p <- perc_form(la_age_cc_data %>% filter(age_name=="Aged 25-49" & is_la==1) %>%
  filter(p_change_since_mar20==max(p_change_since_mar20)) %>% 
  pull(p_change_since_mar20),d=0)

high_50_la_name <- la_age_cc_data %>% filter(age_name=="Aged 50+" & is_la==1) %>%
  filter(p_change_since_mar20==max(p_change_since_mar20)) %>% 
  pull(geography_name)

high_50_la_p <- perc_form(la_age_cc_data %>% filter(age_name=="Aged 50+" & is_la==1) %>%
  filter(p_change_since_mar20==max(p_change_since_mar20)) %>% 
  pull(p_change_since_mar20),d=0)

```

## Changes by age group

<br/>

The change in claimant count by age group varies significantly across local authorities. Since March 2020 (excl. City of London):

- Aged 16-24: `r high_1624_la_name` saw the highest percentage change at `r high_1624_la_p`%.

- Aged 25-49: `r high_2549_la_name` saw the highest percentage change at `r high_2549_la_p`%.

- Aged 50+: `r high_50_la_name` saw the highest percentage change at `r high_50_la_p`%.


<a href="#top">Back to top</a>

```{r cc bubble chart bar rate by LA, echo=FALSE,fig.cap = la_bubble_cap, out.width='100%'}
  
  highlight_colour <- gla_pal(gla_theme = "default",palette_name = "brand", main_colours="red",  n = 1) # for highlighting individiual points
  
  pal <- gla_pal(gla_theme = "default", palette_type = "highlight", n = c(2,1)) #for the chart only two highlight colours needed
  pal_named <- setNames(pal,c("UK","London","Boroughs"))
  
  # Axes info
  age_cats <- unique(la_age_cc_data$age_name)
  max_p_change_axis_value <- ceiling(max(la_age_cc_data$p_change_since_mar20)/50)*50
  
  la_bubble_change_chart <- la_age_cc_data %>% 
    select(geography_name,age_name,p_change_since_mar20,measure_value,geo_cat,jit_age) %>% 
    highlight_key(~geography_name,"Highlight a borough") %>% # For highlighting bubble
    ggplot(aes(text = paste0(geography_name,"\n",
                            age_name, "\n",
                            "Change: ", perc_form(p_change_since_mar20,d=0),"%", "\n",
                            paste0("Count, ",cc_newdate_form_abr,": "), value_form(measure_value,s=signif_thous),"\n"))) +
    geom_point(aes(x = p_change_since_mar20,
                   y = jit_age,
                   fill=factor(geo_cat),
                   color=factor(geo_cat)),
               size=5,
               shape=16,
               stroke=0,
               alpha=.5)+
    geom_vline(aes(xintercept=0), colour="gray45") +
    scale_fill_manual(values=pal_named, aesthetics = "fill")+
    scale_color_manual(values=pal_named, aesthetics = "color") +
    scale_y_discrete(breaks =1:length(age_cats) ,
                     labels=rev(age_cats), #youngest at top so should be reversed
                     limits = seq(1:length(age_cats)))+
    scale_x_continuous(limits = c(0, max_p_change_axis_value), labels = dollar_format(prefix = "", 
                                                                                      suffix = "%", 
                                                                                      largest_with_cents = 1)) +
    theme_set(theme_gla(gla_theme = "default", y_label_length=100)) + #GLA theme and removes lines below y-axis labels
    theme(panel.grid.major.y = element_blank(), #removed y grid
          panel.grid.minor.y = element_blank(), # removes small y grid
          panel.grid.major.x = element_line( size=.5 ), # removes x grid
          axis.text.y = ggplot2::element_text( # ensures  y axis labels stay outside chart
            hjust = 0, vjust = 0.5,
            margin = ggplot2::margin(t = 0, r = 0, b = 0, l = 0,
                                     unit = "pt")),
          axis.ticks.length.y = ggplot2::unit(x = 0, units = "pt"),  #removes ticks from y axis
          plot.margin = unit(c(1,1,1,1), "cm"), #margins around plot image
          axis.text=element_text(size=12)) +
    labs(title = paste0("Change in claimant count by local authority and age group"),
         subtitle = paste0("Non-seasonally adjusted, percentage change between March 2020 and ", cc_newdate_form),
         caption = "\nSource:  Claimant count by sex and age (Nomis) – data is not seasonally adjusted.")+
    theme(plot.caption = element_text(color = rgb(166,166,166,maxColorValue = 255)))
  
  ggsave(paste0(IMAGES,Sys.Date(),"_","la_bubble",".svg"), device = "svg", width = 8, height = 8, units = "in")
  ggsave(paste0(IMAGES,Sys.Date(),"_","la_bubble",".png"), device = "png", width = 8, height = 8, units = "in")
  
  ggplotly(la_bubble_change_chart,tooltip = "text")%>% 
    ggla_plotly_settings()    %>% 
    plotly::layout(title = list(text = paste0("<b>","Change in claimant count by local authority and age group","</b>",
                                              "<br>",
                                              "<sup>",
                                              paste0("Non-seasonally adjusted, percentage change between March 2020 and ", cc_newdate_form),
                                              "</sup>",
                                              "<br>"),
                                font = list(size = 22),
                                y = .95, xref = "plot"),
                   xaxis = list(tickfont = list(size = 14), showgrid=TRUE),
                   yaxis = list(tickfont = list(size = 12), showgrid=FALSE),
                   legend = list(font = list(size = 14),title=list(text="")),
                   margin = list(l = 50)) %>% 
    plotly::highlight(color=highlight_colour,
                      on = "plotly_click",
                      off = "plotly_doubleclick",
                      selectize=TRUE,
                      opacityDim=0.9,
                      selected = attrs_selected(
                        showlegend = FALSE,
                        mode="markers")) %>% 
    reverse_legend_labels() %>% 
    plotly_modebar
  
  la_bubble_cap <- paste0("Source: Claimant count by sex and age (Nomis) – data is not seasonally adjusted.","<br>","<br>", "Note: Excludes City of London")

```

<hr  width="100%" style="background-color: rgb(134,139,142);height: 1.0px;margin: 0;"/>

<br/>

## Claimant data by sub-region {.tabset}

<br/>

The tables below provide detailed breakdowns of claimant count statistics for each London local authority, grouped by their respective London sub-regional partnership areas.
 
The ranks are assigned across all local authorities rather than within sub-regional partnerships.

<a href="#top">Back to top</a>

```{r tables, echo=FALSE, out.width='100%'}

# We should make it interactive, but make defaults based on our standard, i.e.
# actual count, claimant rate and claimants aged 16-24 main groupings
# changes by month and from march 2020
# rank of borough by number of claimants
  
  cc_data_cleaned <- cc_changes_stats %>% 
    mutate(measure_simple=recode(measure_name,
                                 "claimants_as_a_proportion_of_economically_active_residents_aged_16"="rate_econ_active_16",
                                 "claimants_as_a_proportion_of_residents_aged_16_64"="rate_resid_16_64",
                                 "claimants_as_a_proportion_of_the_workforce"="rate_workforce"),
           age_simple=sub("\\+","_",sub("All categories: Age ","",sub("-","_",sub("Aged ","",age_name)))))

  table_format <- cc_data_cleaned %>% 
    mutate(measure_simple = case_when( date_day==cc_prev_month ~ paste0(measure_simple,"_prev"),
                                       date_day==as.Date("2020-03-01") ~ paste0(measure_simple,"_mar20"),
      TRUE ~ measure_simple))  %>% 
      filter((date_day==max(date_day) | (measure_simple %in% c("rate_resid_16_64_prev","rate_resid_16_64_mar20"))) & ##this keeps most recent data and the previous month's claim rate
               age_name %in% c("Aged 18-24","All categories: Age 16+"),
             dataset_name=="detailed") 

  
  borough_ranks <- table_format %>% #Find rankings based on most recent counts
    filter(is_la==1 & measure_simple %in% c("claimant_count","rate_resid_16_64")) %>% 
    group_by(sex_name,age_name,measure_simple) %>% 
    select(sex_name,age_name,geography_name,measure_value,measure_simple) %>% 
    mutate(rank_in_group=rank(desc(measure_value),ties.method="first")) %>% 
    arrange(sex_name,age_name,measure_simple,rank_in_group) %>% 
    select(-c(measure_value))
  
  table_format_reshaped <- table_format %>%
    filter(measure_simple %in% c("claimant_count","rate_resid_16_64","rate_resid_16_64_mar20")) %>%
    select(-c(yoy_change,yoy_percentage_change)) %>% 
    merge(borough_ranks,by=c("sex_name","age_name","geography_name","measure_simple"),all=TRUE) %>% #merge with rankings
    merge(lon_subregion_map,by="geography_name",all=TRUE) %>% #merge with sub-regions
    pivot_wider(id_cols=c(geography_name,sex_name,subregional_partnership),
                names_from = c(measure_simple,age_simple),
                values_from = c(measure_value:mom_p_change,rank_in_group),
                names_sep = "@") 
  
  table_col_order <- c("geography_name",
                       "measure_value@claimant_count@16_","rank_in_group@claimant_count@16_", #claim count for 16+
                       "mom_d_change@claimant_count@16_","mom_p_change@claimant_count@16_",
                       "d_change_since_mar20@claimant_count@16_","p_change_since_mar20@claimant_count@16_",
                       "measure_value@rate_resid_16_64_mar20@16_","measure_value@rate_resid_16_64@16_","rank_in_group@rate_resid_16_64@16_", #claimant rate
                       # "measure_value@claimant_count@18_24","rank_in_group@claimant_count@18_24", #claim count for 16-24
                       # "mom_d_change@claimant_count@18_24","mom_p_change@claimant_count@18_24",
                       # "d_change_since_mar20@claimant_count@18_24","p_change_since_mar20@claimant_count@18_24",
                       "sex_name","subregional_partnership") #for filtering
  
  table_format_slim <- table_format_reshaped[,table_col_order] %>% 
    add_row() %>% 
    mutate(row_order=case_when(geography_name=="United Kingdom" ~ 1,
                               geography_name=="London" ~ 2,
                               geography_name %in% subregions_vector ~ 3,
                               is.na(geography_name) ~ 4,
                               TRUE ~ 9),
           subregional_partnership = case_when(geography_name %in% subregions_vector ~ geography_name,
                                               TRUE ~ subregional_partnership)) %>% #For subregion rows
    arrange(row_order, geography_name)
  
  #----- Create separate tables for each sub-regional partnership
  
  for (subr in subregions_vector) {
    
    df_name <- paste0("totals_table_out_",sub(" ","_",subr))
    table_name <- paste0("reactable_",sub(" ","_",subr))
    
    df_temp <- table_format_slim %>% 
      filter(sex_name=="Total" | is.na(sex_name)) %>%  #the latter keeps the empty row
      filter(subregional_partnership %in% c(subr,NA)) %>% 
      select(-c(row_order,subregional_partnership,sex_name)) %>% 
      mutate(across(contains("p_change_since_mar20"),
                    ~ case_when(!is.na(.) ~ perc_form(.,d=0))), #formatting values in table
             across(contains("mom_p_change"),
                    ~ case_when(!is.na(.) ~ perc_form(.,d=1))),
             across(contains("d_change"),
                    ~ case_when(!is.na(.) ~value_form(.,s=9))),
             across(contains("measure_value@claimant_count"),
                    ~ case_when(!is.na(.) ~value_form(.,s=9))),
             across(contains("measure_value@rate"),
                    ~ case_when(!is.na(.) ~perc_form(.,d=1)))
             ) %>% 
      mutate(sort_order=row_number()) %>% #to allow resetting the sorting
      relocate(sort_order)
    
    table_temp <- reactable(df_temp, #Settings for the tables
                            pagination = FALSE,
                            wrap = TRUE,
                            striped = TRUE,
                            defaultColDef = colDef(
                              align = "right",
                              width = 68,
                              headerStyle = list(align="center"),
                              sortNALast = TRUE
                            ),
                            style=list(fontSize=14,fontFamily="Arial"),
                            highlight = TRUE,
                            #defaultSorted = "sort_order",
                            rowStyle = function(index) {
                              if (index %in% c(1:4)) list(background = "white"
                                                          #fontWeight="bold"
                              )
                            },
                            columns = list( #the below gives proper names to columns and formats
                              "sort_order" = colDef(name = knitr::asis_output("\U25BC"),
                                                    style = list(color=rgb(0,0,255,alpha=0,max=255)),
                                                    headerStyle = list(color="black"),
                                                    width = 40),
                              "geography_name" = colDef(name = "",width = 160,filterable = FALSE),
                              "measure_value@claimant_count@16_"= colDef(name = "Number",width = 80),
                              "rank_in_group@claimant_count@16_"= colDef(name = "(rank)",
                                                                         style = list(color="gray"),
                                                                         headerStyle = list(color="gray"),
                                                                         format = colFormat(prefix = "(", suffix = ")")),  
                              "mom_d_change@claimant_count@16_"= colDef(name = paste0(cc_prev_month_abr,"-",cc_newdate_form_abr,"\n","change (level)")
                                                                        ,width = 100),
                              "mom_p_change@claimant_count@16_"= colDef(name = "change (%)",
                                                                        format = colFormat(suffix = "%")), 
                              "d_change_since_mar20@claimant_count@16_"= colDef(name = paste0("Mar 20-",cc_newdate_form_abr,"\n","change (level)")
                                                                                ,width = 100),
                              "p_change_since_mar20@claimant_count@16_"= colDef(name = "change (%)",
                                                                                format = colFormat(suffix = "%")), 
                              "measure_value@rate_resid_16_64_mar20@16_"= colDef(name = cc_mar20_abr,
                                                                                 format = colFormat(suffix = "%")),
                              "measure_value@rate_resid_16_64@16_"= colDef(name = cc_newdate_form_abr,
                                                                           format = colFormat(suffix = "%")), 
                              "rank_in_group@rate_resid_16_64@16_"= colDef(name = "(rank)",
                                                                           style = list(color="gray"),
                                                                           headerStyle = list(color="gray"),
                                                                           format = colFormat(prefix = "(", suffix = ")"))
                            ),
                            columnGroups = list( #Providers column group names
                              # colGroup(name = "Geography",
                              #          columns = "geography_name"),
                              colGroup(name = "Actual claimant count",
                                       columns=c("measure_value@claimant_count@16_","rank_in_group@claimant_count@16_",
                                                 "mom_d_change@claimant_count@16_","mom_p_change@claimant_count@16_",
                                                 "d_change_since_mar20@claimant_count@16_","p_change_since_mar20@claimant_count@16_")),
                              colGroup(name = "Claimant rate (16-64)",
                                       columns=c("measure_value@rate_resid_16_64_mar20@16_","measure_value@rate_resid_16_64@16_","rank_in_group@rate_resid_16_64@16_"))
                            )
    )
    assign(df_name,df_temp) #give dynamic name
    assign(table_name,table_temp) #give dynamic name
    
    remove(df_temp)
    remove(df_name)
    remove(table_temp)
    remove(table_name)
  }
  
  remove(subr)
  
  
  subr_table_cap <- paste0("Source: Claimant count by sex and age (via Nomis) – data is not seasonally adjusted and the figures are rounded to the nearest 5.","<br>","<br>",
                 "Notes: ",
                 "Local authorities are ranked within London overall (not by sub-region); claimant rates for sub-regions have been calculated using aggregated local authority data.")
  
```

### Central London Forward

``` {r table CLF, echo=FALSE,fig.cap = subr_table_cap, out.width='100%'}

`reactable_Central_London Forward`

```

### Local London

``` {r table LL, echo=FALSE,fig.cap = subr_table_cap, out.width='100%'}

`reactable_Local_London`

```

### South London Partnership

``` {r table SLP, echo=FALSE,fig.cap = subr_table_cap, out.width='100%'}

`reactable_South_London Partnership`


```

### West London Alliance

``` {r table WLA, echo=FALSE,fig.cap = subr_table_cap, out.width='100%'}

`reactable_West_London Alliance`


```

<br/>
<br/>

</font>

::: {.tocify-extend-page data-unique="tocify-extend-page" style="height: 0;"}
:::
